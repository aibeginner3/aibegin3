Private Sub cmdDefineFile_Click()
    
    Dim fType, prompt As String
    Dim fPath As Variant
    Dim buf As String
    Dim defCond(10), defCondNum(10) As String
    
    '操作中のエクセルファイルがあるフォルダに移動
    ChDir ThisWorkbook.Path
    
    '選択できるファイルの種類を指定
    fType = "テキストファイル (*.txt),.txt"
    'ダイアログのタイトルを指定
    prompt = "コンパイルSWファイルを選択して下さい"
    'ファイル参照ダイアログの表示
    fPath = Application.GetOpenFilename(fType, 0, prompt)
    
    'ダイアログでキャンセルボタンが押された場合は処理を終了します
    If fPath = False Then
        End
    End If
    
    'ダイアログで選択したファイル名をテキストボックスに表示
    txtDefineFile.Text = fPath
    
    'ファイルを読み込みリスト項目に追加
    lblDefineFileComment.Caption = ""
    cboCompSet.Clear
    Open fPath For Input As #1
        Do Until EOF(1)
            Line Input #1, buf
            '#defineの行チェック
            'COMP_CONDITIONの行チェック
            cboCompSet.AddItem Split(buf, " ")(0)
        Loop
    Close #1

End Sub

Private Sub cmdSoftFolder_Click()
    
    '操作中のエクセルファイルがあるフォルダに移動
    ChDir ThisWorkbook.Path
    
    'ダイアログで選択したフォルダ名をテキストボックスに表示
    With Application.FileDialog(msoFileDialogFolderPicker)
        If .Show = True Then
            txtSoftFolder.Text = .SelectedItems(1)
        End If
    End With
    
End Sub

Private Sub cmdExecute_Click()

    'コマンドプロンプトを使うためのオブジェクト
    Dim wsh, dirname, sCmd, result As String
    Set wsh = CreateObject("WScript.Shell")
    
    'FileSystemObjectインスタンスを生成
    Dim fi As New FileSystemObject
    
    '''''''''''''''''''''''''''''''''''''''''''''''
    'テキスト内容確認（エラーチェック）
    fCheck = 0
    
    'コンパイルスイッチ設定が選択されていない場合
    If cboCompSet.Text = "" Then
        MsgBox "設定が選択されていません"
        fCheck = 1
    End If
    
    'ソフトのフォルダが設定されていない場合
    If txtSoftFolder.Text = "" Then
        MsgBox "フォルダが設定されていません"
        fCheck = 2
    End If
    
    'フォルダが存在する場合
    If Dir(txtSoftFolder.Text, vbDirectory) <> "" Then
        'フォルダではなくファイルの場合
        If fi.FileExists(txtSoftFolder.Text) Then
            lblSoftFolderComment.Caption = TextBox2.Text & "はファイル名です"
            fCheck = 3
        End If
    'フォルダが存在しない場合
    Else
        lblSoftFolderComment.Caption = txtSoftFolder.Text & "が存在しません"
        fCheck = 4
    End If
    '''''''''''''''''''''''''''''''''''''''''''''''
    
    'テキストとフォルダが正しく設定されている場合に実行する
    If fCheck = 0 Then
        'エクセルファイルのPathを確認
        dirname = ThisWorkbook.Path
        
        '操作中のエクセルファイルがあるフォルダに移動
        ChDir dirname
    
        'python実行コマンド
        sCmd = dirname & "\py\python " & dirname & "\print.py " & cboCompSet.Text & " " & txtSoftFolder.Text
        result = wsh.Run("%ComSpec% /c " & sCmd, 0, True)
        MsgBox "実行終了"
        
        'オブジェクト解放
        Set wsh = Nothing
    End If

End Sub

Private Sub cmdClose_Click()

    'ユーザーフォームを閉じる
    Unload UserForm1

End Sub

Private Sub txtDefineFile_Change()

    'FileSystemObjectインスタンスを生成
    Dim fi As New FileSystemObject
    
    'テキストボックスに表示がない場合
    If txtDefineFile.Text = "" Then
        lblDefineFileComment.Caption = ""
    Else
        'テキストボックスに表示がある場合
        'ファイルが存在する場合
        If fi.FileExists(txtDefineFile.Text) Then
            lblDefineFileComment.Caption = ""
            'ファイルを読み込んでリスト項目に追加
            cboCompSet.Clear
            Open txtDefineFile.Text For Input As #1
                Do Until EOF(1)
                    Line Input #1, buf
                    cboCompSet.AddItem Split(buf, " ")(0)
                Loop
            Close #1
        'ファイルが存在しない場合
        Else
            cboCompSet.Clear
            lblDefineFileComment.Caption = txtDefineFile.Text & " :存在するファイル名ではありません"
        End If
    End If
        
End Sub

Private Sub txtSoftFolder_Change()

    'FileSystemObjectインスタンスを生成
    Dim fi As New FileSystemObject
    
    'テキストボックスに表示がない場合
    If txtSoftFolder.Text = "" Then
        lblSoftFolderComment.Caption = ""
    Else
        'テキストボックスに表示がある場合
        'フォルダが存在する場合
        If Dir(txtSoftFolder.Text, vbDirectory) <> "" Then
            lblSoftFolderComment.Caption = ""
            '存在するファイル名の場合
            If fi.FileExists(txtSoftFolder.Text) Then
                lblSoftFolderComment.Caption = TextBox2.Text & "はファイル名です"
            End If
        'フォルダが存在しない場合
        Else
            lblSoftFolderComment.Caption = txtSoftFolder.Text & "が存在しません"
        End If
    End If
End Sub
